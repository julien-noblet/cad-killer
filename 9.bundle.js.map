{"version":3,"sources":["webpack:///./src/js/layers.js","webpack:///./src/js/photon.js","webpack:///./src/js/map.js","webpack:///./src/js/config.js"],"names":["layerOSMfr","L","tileLayer","maxZoom","attribution","layerOSM","layerMapsurfer","overlayMapsurfer","layerBing","layerBoner","layerCadastre","minZoom","overlayCadastre","layerEsriWorldImagery","baseMaps","OpenStreetMap","IGN_KEY","IGN_LAYER","IGN_LAYER_LITE","MapSurfer","Bing","Cadastre","Esri","overlayMaps","require","searchPoints","geoJson","onEachFeature","feature","layer","on","zoom","properties","type","window","map","setView","geometry","coordinates","bindPopup","name","photonControlOptions","resultsHandler","geojson","clearLayers","addData","placeholder","position","url","API_URL","formatResult","el","details","detailsContainer","DomUtil","create","title","types","housenumber","street","locality","hamlet","village","city","commune","innerHTML","push","context","join","noResultLabel","feedbackLabel","feedbackEmail","minChar","val","SHORT_CITY_NAMES","indexOf","length","submitDelay","myPhoton","Control","Photon","attributionControl","layers","control","Icon","Default","imagePath","addLayer","addTo","CENTER","dragging","enable","prefix","ATTRIBUTIONS","Hash","addControl","search","__proto__","setChoice","choice","c","this","RESULTS","CURRENT","hide","input","value","fire","onSelected","browserPrint","printModes","mode","portrait","landscape","auto","custom","REVERSE_URL"],"mappings":"4HAUaA,EAAkBC,IAAEC,UAC/B,oDACA,CACEC,QAAS,GACTC,YACE,qFAIOC,EAAgBJ,IAAEC,UAC7B,+CACA,CACEC,QAAS,GACTC,YACE,+EAIOE,EAAsBL,IAAEC,UACnC,gEACA,CACEC,QAAS,GACTC,YACE,oFAIAG,EAAwBN,IAAEC,UAC9B,iEACA,CACEC,QAAS,GACTC,YACE,gFAIOI,EAAiBP,IAAEC,UAC9B,mDACA,CACEC,QAAS,GACTC,YACE,yEAIOK,EAAkBR,IAAEC,UAC/B,+CACA,CACEC,QAAS,GACTC,YACE,yEAIOM,EAAqBT,IAAEC,UAClC,8DACA,CACEC,QAAS,GACTQ,QAAS,GACTP,YAAa,oBAIJQ,EAAuBX,IAAEC,UACpC,gEACA,CACEC,QAAS,GACTQ,QAAS,GACTP,YAAa,oBAIJS,EAA6BZ,IAAEC,UAC1C,0FACA,CACEE,YACE,4IA8BOU,EAAW,CACtB,uBAAwBd,EACxBe,cAAeV,EACf,YA7B2BJ,IAAEC,UAAF,uBACXc,IADW,6EACiEC,IADjE,6FAE3B,CACEd,QAAS,GACTQ,QAAS,EACTP,YAAa,6DAyBf,WArB+BH,IAAEC,UAAF,uBACfc,IADe,6EAC6DE,IAD7D,6FAE/B,CACEf,QAAS,GACTQ,QAAS,EACTP,YAAa,6DAiBfe,UAAWb,EACXc,KAAMZ,EACN,WAAYC,EACZY,SAAUX,EACVY,KAAMT,GAGKU,EAAc,CACzBF,SAAUT,EACV,SAtB6BX,IAAEC,UAC/B,qDACA,CACEC,QAAS,GACTC,YAAa,6BAmBfe,UAAWZ,GCzHbiB,EAAQ,IAMR,IAAMC,EAAexB,IAAEyB,QAAQ,KAAM,CACnCC,cAAe,SAACC,EAASC,GACvBA,EAAMC,GAAG,SAAS,WAChB,IAAIC,EAAO,GACX,OAAQH,EAAQI,WAAWC,MACzB,IAAK,cACHF,EAAO,GACP,MACF,IAAK,SACHA,EAAO,GACP,MACF,IAAK,UAGL,IAAK,OACHA,EAAO,GACP,MACF,IAAK,WAGL,IAAK,SACHA,EAAO,GACP,MACF,IAAK,UACHA,EAAO,GACP,MACF,QACEA,EAAO,GAEXG,OAAOC,IAAIC,QACT,CAACR,EAAQS,SAASC,YAAY,GAAIV,EAAQS,SAASC,YAAY,IAC/DP,MAIJF,EAAMU,UAAN,UACKX,EAAQI,WAAWQ,KADxB,oCACwDZ,EAAQS,SAASC,YAAY,GADrF,YAC2FV,EAAQS,SAASC,YAAY,GADxH,qDAyCJ,IAAMG,EAAuB,CAC3BC,eApCF,SAA0BC,GACxBlB,EAAamB,cACbnB,EAAaoB,QAAQF,IAmCrBG,YAAa,mCACbC,SAAU,WACVC,IAAKC,IACLC,aAnCF,SAAsBtB,EAASuB,GAC7B,IAAMC,EAAU,GACVC,EAAmBpD,IAAEqD,QAAQC,OAAO,QAAS,GAAIJ,GACjDK,EAAQvD,IAAEqD,QAAQC,OAAO,SAAU,GAAIJ,GACvCM,EAAQ,CACZC,YAAa,SACbC,OAAQ,MACRC,SAAU,WACVC,OAAQ,SACRC,QAAS,UACTC,KAAM,QACNC,QAAS,WAEXR,EAAMS,UAAYrC,EAAQI,WAAWQ,KACjCiB,EAAM7B,EAAQI,WAAWC,QAC3BhC,IAAEqD,QAAQC,OAAO,OAAQ,OAAQC,GAAOS,UACtCR,EAAM7B,EAAQI,WAAWC,OAG3BL,EAAQI,WAAW+B,MACnBnC,EAAQI,WAAW+B,OAASnC,EAAQI,WAAWQ,MAE/CY,EAAQc,KAAKtC,EAAQI,WAAW+B,MAE9BnC,EAAQI,WAAWmC,SACrBf,EAAQc,KAAKtC,EAAQI,WAAWmC,SAElCd,EAAiBY,UAAYb,EAAQgB,KAAK,OAS1CC,cAAe,iBACfC,cAAe,WACfC,cAAe,qCACfC,QAAS,SAACC,GAAD,OAA4C,IAAnCC,IAAiBC,QAAQF,IAAeA,EAAIG,QAAU,GACxEC,YAAa,KAeTC,EAAW,IAAI7E,IAAE8E,QAAQC,OAAOvC,GCzGtCjB,EAAQ,IACRA,EAAQ,IAURU,OAAOC,IAAMlC,IAAEkC,IAAI,MAAO,CACxB8C,oBAAoB,IAGtB,IAAMC,EAASjF,IAAEkF,QAAQD,OAAOpE,EAAUS,GAE1CtB,IAAEmF,KAAKC,QAAQC,UAAY,YAC3BpD,OAAOC,IAAIoD,SAASvF,GAEpBkF,EAAOM,MAAMtD,OAAOC,KAEpBD,OAAOC,IAAIC,QAAQqD,IAAQ,GAE3BvD,OAAOC,IAAIuD,SAASC,SAEpB1F,IAAEkF,QACC/E,YAAY,CACX2C,SAAU,aACV6C,OAAQC,MAETL,MAAMtD,OAAOC,KAIT,IAAIlC,IAAE6F,KAAK5D,OAAOC,KDyEvBV,EAAa+D,MAAMtD,OAAOC,KAE1BD,OAAOC,IAAI4D,WAAWjB,GAEtBA,EAASkB,OAAOC,UAAUC,UAAY,SAAmBC,GACvD,IAAMC,EAAID,GAAUE,KAAKC,QAAQD,KAAKE,SAClCH,IAEFC,KAAKG,OACLH,KAAKI,MAAMC,MAAQ,GACnBL,KAAKM,KAAK,WAAY,CAAER,OAAQC,EAAExE,UAClCyE,KAAKO,WAAWR,EAAExE,WC/ExBJ,wBACEA,EAAQ,KADV,0BAaAvB,IAAEkF,QACC0B,aAAa,CACZC,WAAY,CACV7G,IAAEkF,QAAQ0B,aAAaE,KAAKC,SAAS,WAAY,MACjD/G,IAAEkF,QAAQ0B,aAAaE,KAAKE,UAAU,UAAW,MACjDhH,IAAEkF,QAAQ0B,aAAaE,KAAKG,KAAK,OAAQ,MACzCjH,IAAEkF,QAAQ0B,aAAaE,KAAKI,OAAO,uBAAwB,SAG9D3B,MAAMtD,OAAOC,M,gCC1EhB,gRAMO,IAAMsD,EAAS,CAAC,OAAQ,OAClBxC,EAAU,sCACVmE,EAAc,uCACd1C,EAAmB,CAC9B,IACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,MAEWmB,EACX,yNACW7E,EAAU,2BACVC,EAAY,+BACZC,EAAiB","file":"9.bundle.js","sourcesContent":["/**\n * @flow\n *\n * @format\n */\n\nimport L from \"leaflet\";\nimport { IGN_KEY, IGN_LAYER, IGN_LAYER_LITE } from \"./config\";\n\n// Layers\nexport const layerOSMfr: any = L.tileLayer(\n  \"//{s}.tile.openstreetmap.fr/osmfr/{z}/{x}/{y}.png\",\n  {\n    maxZoom: 20,\n    attribution:\n      'Fond de plan &copy; <a href=\"https://openstreetmap.fr/\">OpenStreetMap France</a>',\n  }\n);\n\nexport const layerOSM: any = L.tileLayer(\n  \"//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\",\n  {\n    maxZoom: 19,\n    attribution:\n      'Fond de plan &copy; <a href=\"https://openstreetmap.org/\">OpenStreetMap</a>',\n  }\n);\n\nexport const layerMapsurfer: any = L.tileLayer(\n  \"//korona.geog.uni-heidelberg.de/tiles/roads/x={x}&y={y}&z={z}\",\n  {\n    maxZoom: 19,\n    attribution:\n      'Fond de plan &copy; <a gref=\"http://openmapsurfer.uni-hd.de/\">OpenMapSurfer</a>',\n  }\n);\n\nconst overlayMapsurfer: any = L.tileLayer(\n  \"//korona.geog.uni-heidelberg.de/tiles/hybrid/x={x}&y={y}&z={z}\",\n  {\n    maxZoom: 19,\n    attribution:\n      'Surcouche &copy <a gref=\"http://openmapsurfer.uni-hd.de/\">OpenMapSurfer</a>',\n  }\n);\n\nexport const layerBing: any = L.tileLayer(\n  \"http://tile.stamen.com/bing-lite/{z}/{x}/{y}.jpg\",\n  {\n    maxZoom: 18,\n    attribution:\n      'Vue satellite &copy; <a href=\"https://bing.com/\">Bing</a> via Stamen',\n  }\n);\n\nexport const layerBoner: any = L.tileLayer(\n  \"http://tile.stamen.com/boner/{z}/{x}/{y}.jpg\",\n  {\n    maxZoom: 18,\n    attribution:\n      'Vue satellite &copy; <a href=\"https://bing.com/\">Bing</a> via Stamen',\n  }\n);\n\nexport const layerCadastre: any = L.tileLayer(\n  \"http://tms.cadastre.openstreetmap.fr/*/tout/{z}/{x}/{y}.png\",\n  {\n    maxZoom: 22,\n    minZoom: 16,\n    attribution: \"&copy; Cadastre\",\n  }\n);\n\nexport const overlayCadastre: any = L.tileLayer(\n  \"http://tms.cadastre.openstreetmap.fr/*/transp/{z}/{x}/{y}.png\",\n  {\n    maxZoom: 22,\n    minZoom: 16,\n    attribution: \"&copy; Cadastre\",\n  }\n);\n\nexport const layerEsriWorldImagery: any = L.tileLayer(\n  \"//server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}\",\n  {\n    attribution:\n      \"&copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community\",\n  }\n);\n\nexport const layerIGN: any = L.tileLayer(\n  `//wxs.ign.fr/${IGN_KEY}/geoportail/wmts?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER=${IGN_LAYER}&STYLE=normal&TILEMATRIXSET=PM&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}&FORMAT=image%2Fjpeg`,\n  {\n    maxZoom: 18,\n    minZoom: 6,\n    attribution: 'Fond de plan &copy; <a href=\"https://www.ign.fr\">IGN</a>',\n  }\n);\n\nexport const layerIGNlite: any = L.tileLayer(\n  `//wxs.ign.fr/${IGN_KEY}/geoportail/wmts?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER=${IGN_LAYER_LITE}&STYLE=normal&TILEMATRIXSET=PM&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}&FORMAT=image%2Fjpeg`,\n  {\n    maxZoom: 18,\n    minZoom: 6,\n    attribution: 'Fond de plan &copy; <a href=\"https://www.ign.fr\">IGN</a>',\n  }\n);\n\nexport const overlayBAN: any = L.tileLayer(\n  \"//{s}.layers.openstreetmap.fr/bano/{z}/{x}/{y}.png\",\n  {\n    maxZoom: 20,\n    attribution: \"Surcouche: &copy; BAN(O)\",\n  }\n);\n\nexport const baseMaps = {\n  \"OpenStreetMap France\": layerOSMfr,\n  OpenStreetMap: layerOSM,\n  \"Carte IGN\": layerIGN,\n  \"Plan IGN\": layerIGNlite,\n  MapSurfer: layerMapsurfer,\n  Bing: layerBing,\n  \"Bing+OSM\": layerBoner,\n  Cadastre: layerCadastre,\n  Esri: layerEsriWorldImagery,\n};\n\nexport const overlayMaps = {\n  Cadastre: overlayCadastre,\n  \"BAN(O)\": overlayBAN,\n  MapSurfer: overlayMapsurfer,\n};\n","/**\n * @flow\n *\n * @format\n */\n\nimport L from \"leaflet\";\nimport { API_URL, SHORT_CITY_NAMES } from \"./config\";\n//import { sendClick, sendSearch } from \"./stats\";\n\nrequire(\"leaflet.photon\");\n/**\n * Un grand merci a @etalab, @yohanboniface, @cquest sans qui ce projet n'existerai pas.\n * Une grande partie de ce code vient de @etalab/adresse.data.gouv.fr\n */\n\nconst searchPoints = L.geoJson(null, {\n  onEachFeature: (feature, layer) => {\n    layer.on(\"click\", () => {\n      let zoom = 16;\n      switch (feature.properties.type) {\n        case \"housenumber\":\n          zoom = 18;\n          break;\n        case \"street\":\n          zoom = 16;\n          break;\n        case \"village\":\n          zoom = 12;\n          break;\n        case \"city\":\n          zoom = 12;\n          break;\n        case \"locality\":\n          zoom = 16;\n          break;\n        case \"hamlet\":\n          zoom = 16;\n          break;\n        case \"commune\":\n          zoom = 12;\n          break;\n        default:\n          zoom = 16;\n      }\n      window.map.setView(\n        [feature.geometry.coordinates[1], feature.geometry.coordinates[0]],\n        zoom\n      );\n      // sendClick(feature); // Stats are not working\n    });\n    layer.bindPopup(\n      `${feature.properties.name}<a class='geo' href='geo:${feature.geometry.coordinates[1]},${feature.geometry.coordinates[0]}'><i class='zmdi-navigation zmdi-2x'></i></a>`\n    );\n  },\n});\n\nfunction showSearchPoints(geojson) {\n  searchPoints.clearLayers();\n  searchPoints.addData(geojson);\n}\n\nfunction formatResult(feature, el) {\n  const details = [];\n  const detailsContainer = L.DomUtil.create(\"small\", \"\", el);\n  const title = L.DomUtil.create(\"strong\", \"\", el);\n  const types = {\n    housenumber: \"numéro\",\n    street: \"rue\",\n    locality: \"lieu-dit\",\n    hamlet: \"hamlet\", // TODO: Hameau?\n    village: \"village\",\n    city: \"ville\",\n    commune: \"commune\",\n  };\n  title.innerHTML = feature.properties.name;\n  if (types[feature.properties.type]) {\n    L.DomUtil.create(\"span\", \"type\", title).innerHTML =\n      types[feature.properties.type];\n  }\n  if (\n    feature.properties.city &&\n    feature.properties.city !== feature.properties.name\n  ) {\n    details.push(feature.properties.city);\n  }\n  if (feature.properties.context) {\n    details.push(feature.properties.context);\n  }\n  detailsContainer.innerHTML = details.join(\", \");\n}\n\nconst photonControlOptions = {\n  resultsHandler: showSearchPoints,\n  placeholder: \"Ex. 6 quai de la tourelle cergy…\",\n  position: \"topright\",\n  url: API_URL,\n  formatResult,\n  noResultLabel: \"Aucun résultat\",\n  feedbackLabel: \"Signaler\",\n  feedbackEmail: \"julien.noblet+cad-killer@gmail.com\",\n  minChar: (val) => SHORT_CITY_NAMES.indexOf(val) !== -1 || val.length >= 3,\n  submitDelay: 200,\n};\n\n/*\n// not need\nconst photonReverseControlOptions = {\n  resultsHandler: showSearchPoints,\n  position: \"topleft\",\n  url: REVERSE_URL,\n  formatResult,\n  noResultLabel: \"Aucun résultat\",\n  tooltipLabel: \"Cliquer sur la carte pour obtenir l'adresse\"\n};\n*/\n\nconst myPhoton = new L.Control.Photon(photonControlOptions);\n\nexport function photon() {\n  searchPoints.addTo(window.map);\n\n  window.map.addControl(myPhoton);\n  /* eslint-disable no-proto */\n  myPhoton.search.__proto__.setChoice = function setChoice(choice) {\n    const c = choice || this.RESULTS[this.CURRENT];\n    if (c) {\n      // sendSearch(c.feature); // Stats are not working\n      this.hide();\n      this.input.value = \"\";\n      this.fire(\"selected\", { choice: c.feature });\n      this.onSelected(c.feature);\n    }\n  };\n  /* eslint-enable no-proto*/\n}\n","/**\n * @flow\n *\n * @format\n */\n\nimport L from \"leaflet\";\nimport { ATTRIBUTIONS, CENTER } from \"./config\";\nimport { overlayMaps, baseMaps, layerOSMfr } from \"./layers\";\n//import { dbinfo } from \"./stats\"; // Stats are not working :'(\nimport { photon } from \"./photon\";\n\nrequire(\"leaflet-hash\");\nrequire(\"leaflet.browser.print/dist/leaflet.browser.print.min.js\");\n/**\n * Un grand merci a @etalab, @yohanboniface, @cquest sans qui ce projet n'existerai pas.\n * Une grande partie de ce code vient de @etalab/adresse.data.gouv.fr\n */\n\n// connection à la BD:\n// dbinfo(); // Stats are not working :'(\n\n// Initialisation de leaflet\nwindow.map = L.map(\"map\", {\n  attributionControl: false,\n});\n\nconst layers = L.control.layers(baseMaps, overlayMaps);\n\nL.Icon.Default.imagePath = \"./images/\";\nwindow.map.addLayer(layerOSMfr);\n\nlayers.addTo(window.map);\n\nwindow.map.setView(CENTER, 6);\n\nwindow.map.dragging.enable();\n\nL.control\n  .attribution({\n    position: \"bottomleft\",\n    prefix: ATTRIBUTIONS,\n  })\n  .addTo(window.map);\n\n// ajout hash dans l'URL\nlet hash;\nhash = new L.Hash(window.map);\n\n// Chargement des modules:\n// require('./photon');\nphoton();\nrequire.ensure([\"./reverseLabel\"], function () {\n  require(\"./reverseLabel\");\n});\n/*\n// Removing notes because seems not working!\n// The loading of L.Draw cause also some fails with Jest!\nrequire.ensure([\"./notes\"], function() {\n  require(\"./notes\");\n});\n*/\n//require (\"./geoloc.js\")\n\n// ajout du bouton print\nL.control\n  .browserPrint({\n    printModes: [\n      L.control.browserPrint.mode.portrait(\"Portrait\", \"A4\"),\n      L.control.browserPrint.mode.landscape(\"Paysage\", \"A4\"),\n      L.control.browserPrint.mode.auto(\"Auto\", \"A4\"),\n      L.control.browserPrint.mode.custom(\"Séléctionnez la zone\", \"A4\"),\n    ],\n  })\n  .addTo(window.map);\n","/**\n * @flow\n *\n * @format\n */\n\nexport const CENTER = [46.495, 2.201];\nexport const API_URL = \"//api-adresse.data.gouv.fr/search/?\";\nexport const REVERSE_URL = \"//api-adresse.data.gouv.fr/reverse/?\";\nexport const SHORT_CITY_NAMES = [\n  \"y\",\n  \"ay\",\n  \"bu\",\n  \"by\",\n  \"eu\",\n  \"fa\",\n  \"gy\",\n  \"oo\",\n  \"oz\",\n  \"py\",\n  \"ri\",\n  \"ry\",\n  \"sy\",\n  \"ur\",\n  \"us\",\n  \"uz\",\n];\nexport const ATTRIBUTIONS =\n  \"&copy; <a href='http://www.openstreetmap.org/copyright'>Contributeurs de OpenStreetMap</a> | <a href='https://www.data.gouv.fr/fr/datasets/base-d-adresses-nationale-ouverte-bano/'>Adresses BAN</a> sous licence ODbL\";\nexport const IGN_KEY = \"zh4iqh58bg7a17hqzo16nqfw\";\nexport const IGN_LAYER = \"GEOGRAPHICALGRIDSYSTEMS.MAPS\";\nexport const IGN_LAYER_LITE = \"GEOGRAPHICALGRIDSYSTEMS.PLANIGN\";\nexport const MY_POUCHDB =\n  \"//sidercomourellydiforteep:16f21a8ad23f32de280b36fc338a38a24c5d49b2@couchdb-112956.smileupps.com/stats\";\nexport const LOCAL_POUCHDB = \"cad-killer\";\nexport const OSM_CREDITENTIALS = \"Q0FELUtJTExFUjpkdHl2dWRlbnQ=\";\nexport const NOTE_API = \"//api.openstreetmap.org/api/0.6/notes\";\n"],"sourceRoot":""}